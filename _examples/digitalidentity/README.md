## Table of Contents

1) [Setup](#setup) -
How to initialise the Yoti client

1) [Running the digitalidentity examples](#running-the-profile-example) -
Running the digitalidentity example

## Setup

The YotiClient is the SDK entry point. To initialise it you need include the following snippet inside your endpoint initialisation section:

```Go
clientSdkID := "your-client-sdk-id"
key, err := os.ReadFile("path/to/your-application-pem-file.pem")
if err != nil {
    // handle key load error
}

client, err := yoti.NewClient(
    clientSdkID,
    key)
```

Where:

* `"your-client-sdk-id"` is the SDK Client Identifier generated by Yoti Hub in the Key tab when you create your application.

* `path/to/your-application-pem-file.pem` is the path to the application pem file. It can be downloaded from the Keys tab in the [Yoti Hub](https://hub.yoti.com/).

Please do not open the pem file as this might corrupt the key, and you will need regenerate your key.

Keeping your settings and access keys outside your repository is highly recommended. You can use a package like [godotenv](https://github.com/joho/godotenv) to manage environment variables more easily.


## Running the DigitalIdentity Example

1. Change directory to the profile example folder: `cd _examples/digitalidentity`
2. On the [Yoti Hub](https://hub.yoti.com/):
   1. Set the application domain of your app to `localhost:8080`
   2. Set the scenario callback URL to `/digitalidentity`
3. Rename the [.env.example](_examples/digitalidentity/.env.example) file to `.env` and fill in the required configuration values (mentioned in the [Configuration](#configuration) section)
4. Build with `go build`
5. Start the compiled program by running `./digitalidentity`

Visiting `https://localhost:8080/` should show a webpage with a Yoti button rendered on it

## Estimated Age Examples

This example also includes several endpoints demonstrating the new estimated age functionality with fallback to date_of_birth:

### Available Endpoints

1. **Basic Estimated Age Request**
   - Endpoint: `POST /v2/generate-estimated-age-share`
   - Demonstrates: Requesting `estimated_age` with automatic fallback to `date_of_birth`
   - Receipt URL: `/v2/estimated-age-receipt`

2. **Age Over Verification**
   - Endpoint: `POST /v2/generate-estimated-age-over-share`
   - Demonstrates: Age verification (18+) using estimated age with fallback
   - Receipt URL: `/v2/age-over-receipt`

3. **Age Under Verification**
   - Endpoint: `POST /v2/generate-estimated-age-under-share`
   - Demonstrates: Age verification (under 21) using estimated age with fallback
   - Receipt URL: `/v2/age-under-receipt`

4. **Constrained Age Verification**
   - Endpoint: `POST /v2/generate-estimated-age-constrained-share`
   - Demonstrates: Age verification with source constraints (passport required)
   - Receipt URL: `/v2/constrained-age-receipt`

### Example Usage

```bash
# Request basic estimated age with fallback
curl -X POST https://localhost:8080/v2/generate-estimated-age-share

# Request age over 18 verification with fallback
curl -X POST https://localhost:8080/v2/generate-estimated-age-over-share

# Request age under 21 verification with fallback
curl -X POST https://localhost:8080/v2/generate-estimated-age-under-share

# Request age verification with passport constraint
curl -X POST https://localhost:8080/v2/generate-estimated-age-constrained-share
```

### Generated Policy Examples

The estimated age helpers generate policies with fallback support:

**Basic Estimated Age:**
```json
{
  "wanted": [
    {
      "name": "estimated_age",
      "alternative_names": ["date_of_birth"],
      "accept_self_asserted": false
    }
  ]
}
```

**Age Over 18 with Fallback:**
```json
{
  "wanted": [
    {
      "name": "estimated_age",
      "alternative_names": ["date_of_birth"],
      "derivation": "age_over:18",
      "accept_self_asserted": false
    }
  ]
}
```

### Receipt Processing

The receipt endpoints demonstrate how to retrieve estimated age information with fallback:

```go
// Get estimated age with fallback logic
result, isEstimatedAge := userProfile.EstimatedAgeWithFallback()
if result != nil {
    if isEstimatedAge {
        // estimated_age was returned
        estimatedAge := result.(*attribute.StringAttribute)
        fmt.Printf("Estimated age: %s", estimatedAge.Value())
    } else {
        // date_of_birth was returned as fallback
        dateOfBirth := result.(*attribute.DateAttribute)
        fmt.Printf("Date of birth: %s", dateOfBirth.Value().Format("2006-01-02"))
    }
}
```
